# Analysis of KTR reporters

Signalling pathway activity is often associated with phosphorylation of target proteins. Some of these phosphorylation events result in changed in intracellular localisation (e.g. nuclear to cytoplasmic) of the target protein. Kinase Translocation Reporters (KTRs) are generated by fusing the phosphorylation-sensitive translocation domain of a target protein to a fluorescent reporter. By measuring the nuclear-to-cytoplasmic ration in these reporters it is possible to quantify intracellular signalling pathway activity. This pipeline facilitates KTR image analysis by calculating the cytoplasmic-nuclear ratio for dividing cells in live-cell imaging videos. The final output is a measure of the cytoplasmic to nuclear ratio of a dividing cell tracked across time (as shown):
![image](https://user-images.githubusercontent.com/46695970/121275710-db83dd80-c8ff-11eb-9b01-75433284d26c.png)

And a list of all cells identified per image, with its associated properties (intensity, location, nearest neighbours, etc.): 
![image](https://user-images.githubusercontent.com/46695970/121278201-b5ad0780-c904-11eb-8460-20d8aff02e89.png)


In this example, samples were imaged using SiR-DNA (to mark the nucleous) and DHB-mVenus (KTR for CDK2 activity - labelled as 'KTR'). 

Example images, and the outputs of each stage of the pipeline have been uploaded under the 'Example folder'.

## Image Analysis Pipeline 

THe pipeline segments the nucleus and the cytoplasm of each cell, tracks and measure properties of each identified cell, and calculate the cytoplasmic to nuclear ratio of dividing cells overtime. The pipeline consists of 4 stages: 
1. Fiji: modify original image to improve segmentation
2. CellPose: generate cell segmentation
3. CellProfiler: all downstream steps of data analysis (nuclear segmentation, measuring properties) 
4. Rstudio: calculation of the cytoplasmic-nuclear ratio for a successfully tracked cell overtime

### [Stage 1] Modifying images to improve segmentation
Using the Fiji software ([download here](https://imagej.net/software/fiji/downloads)), the original microscopy images are auto-adjusted for brightness and contrast, followed by smoothing the image twice. This modification improves segmentation accuracy downstream of the pipeline, and can be automated using a Fiji macro. The Fiji macro is uploaded under "1.Fiji_modifyimage_macro.ijm". 

### [Stage 2] Whole cell segmentation
The CellPose software (extension [here](https://colab.research.google.com/github/HenriquesLab/ZeroCostDL4Mic/blob/master/Colab_notebooks/Beta%20notebooks/Cellpose_2D_ZeroCostDL4Mic.ipynb)) colab version is an AI-based, free-to-use method for cell segmentation. Each segmented cell is identified as a 'cell object', which is then used to extract a cytoplasmic mask on Stage 3. Refer to "2.CellPose_parameters.md" for details on the parameters used.

### [Stage 3] Nuclear and cytoplasmic segmentation, tracking and prameter extraction
We used CellProfiler ([download here](https://cellprofiler.org/)) for nuclear segmentation, measuring properties and object tracking. The pipeline used for analysis is uploaded under "3.CellProfiler_pipeline.cpproj". Detailed instruction and optimisation steps are noted in "3.CellProfiler_parameters.md". 

### [Stage 4] Downstream analysis
In our experiment, we were interested in tracking the properties of dividing cells over time. First, we inspected the data generated from stage 3 to identify the cells which divided overtime. Using Rstudio ([download here](https://www.rstudio.com/)), the cytoplasmic-nuclear intensity ratio for each successfully-tracked dividing cell was calculated with respect of the division time (requires cell number input). The code is uploaded under "4.R_CytotoNuRatio.R".

## Optimization Parameters 
The pipeline has been tested using different markers and imaging parameters (epifluorescence vs confocal, 10x vs 20x magnification, fixed vs live samples), and performs consistently. The tunable parameters in stage 2 and 3 of the pipeline have been elaborated separately in the corresponding markdown files. In addition, the identification of dividing cells from stage 3 to 4 of the pipeline is done manually. 

## Acknowledgements 
This project was formulated by Dr. Carla Mulas (Cambridge University), and was executed by Belle Sow (Stanford University). We thank Dr Kevin Chlaut for the constant guidance and Dr Wolfram PÃ¶nisch for advice on the CellPose software. We also thank the Stanford Vice-Provost for Undergraduate Education (Stanford University) for funding this project. 
